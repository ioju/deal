var slide1Height=$('#step-slide1 .collaborate-form-step').height(),slide2Height=$('#step-slide2 .collaborate-form-step').height();const base_url='https://app-dev.autodeal.ro/api/v1',base_url_mobilpay='https://app-dev.autodeal.ro',token='100644|9ZcG86c7wzuhPBrnIJ9D1DwsrZOSsgvL7DJbdp9l',errorColor="hsl(350 100% 13.5%)",errorBg="hsl(350 100% 66.5%)";async function getVignetteCategoryPrices(a){await fetch(`${base_url}/vignette-categories/${a}/prices`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`,'Permissions-Policy':'ch-ua-form-factor'}}).then(a=>a.json()).then(a=>addPrices(a.data))}function removeSuccess(a=0){setTimeout(function(){if(container=document.getElementById('successMessageSubmit'),container==null)return;container.style.display='none',form=document.getElementById('wf-form-rovinieta-detalii'),form.style.display='block'},a*1e3)}function addPrices(n){var j,c,i,g,b,h,a,e,k,d,l,f;const m=document.getElementById('rovList');m.innerHTML="",j=document.createElement('div'),addClass(j,'w-clearfix');for(let m=0;m<n.length;m++)c=n[m],i=document.createElement('div'),addClass(i,'input-group input-fullwidth rovinieta-input'),g=document.createElement('div'),addClass(g,'extra-option-wrap'),b=document.createElement('label'),addClass(b,'radio-button-field-2 fullwidth w-clearfix w-radio'),h=document.createElement('div'),addClass(h,'w-form-formradioinput w-form-formradioinput--inputType-custom radio-button-2 w-radio-input'),m==0&&(addClass(h,'w--redirected-checked'),localStorage.setItem('selectedAvailability',c.availability_code)),a=document.createElement('input'),a.setAttribute('type','radio'),a.setAttribute('name','availability'),a.setAttribute('data-name','availability'),a.setAttribute('style','opacity:0;position:absolute;z-index:-1'),a.setAttribute('value',c.availability_code),a.setAttribute('id',"availability"+m),m==0&&a.setAttribute('checked',"checked"),e=document.createElement('span'),addClass(e,'radio-button-label-2 radio-button-label-3 w-form-label'),e.setAttribute('for',"availability"+m),k=document.createElement('strong'),addClass(k,'bold-text-3'),k.innerHTML=c.availability_name,e.appendChild(k),d=document.createElement('div'),addClass(d,'div-block-13'),l=document.createElement('div'),addClass(l,'text-block-13'),l.innerHTML=c.value+" "+c.currency_code,f=document.createElement('div'),addClass(f,'eur'),f.innerHTML=c.authority_value+" "+c.authority_currency_code,d.appendChild(l),d.appendChild(f),b.appendChild(h),b.appendChild(a),b.appendChild(e),b.appendChild(d),b.addEventListener('click',function(a){a.target.type=='radio'&&localStorage.setItem('selectedAvailability',a.target.value)}),g.appendChild(b),i.appendChild(g),j.appendChild(i);m.appendChild(j)}let toastContainer;function generateToast({message:b,background:c='#00214d',color:d='#fffffe',length:e='3000ms'}){toastContainer.insertAdjacentHTML('beforeend',`<p class="toast" 
    style="background-color: ${c};
    color: ${d};
    animation-duration: ${e}">
    ${b}
  </p>`);const a=toastContainer.lastElementChild;a.addEventListener('animationend',()=>a.remove())}function initToast(){document.body.insertAdjacentHTML('afterbegin',`<div class="toast-container"></div>
  <style>
  .toast-container{position:fixed;z-index:10000;top:8rem;right:1.5rem;display:grid;justify-items:end;gap:.5rem}.toast{line-height:1;padding:.5em 1em;animation:toastIt 7000ms cubic-bezier(.785,.135,.15,.86) forwards;border-radius:4px;font-size:12px;font-weight:400;background:hsl(0,0%,91.8%)!important}@keyframes toastIt{0%,100%{transform:translateY(-150%);opacity:0}10%,90%{transform:translateY(0);opacity:1}}@media screen and (max-width:991px){.toast-container{justify-items:center;background:#fff;width:100%}.toast-container .toast{margin-top:1em}}
  </style>
  `),toastContainer=document.querySelector('.toast-container')}function handleSubmit(b){b.preventDefault();const d=localStorage.getItem('license-number'),e=localStorage.getItem('selectedAvailability'),f=localStorage.getItem('vehicle-country'),a=new FormData(b.target);a.append("availability",e),a.append("registration_number",d),a.append("country",f);const c=new URLSearchParams(a);c.delete("_redirect"),localStorage.setItem("querystring2",c.toString());const g=localStorage.getItem("querystring2");postVignetteAllData("card",g),removeSuccess(5)}function hasClass(a,b){return new RegExp('(\\s|^)'+b+'(\\s|$)').exec(a.className)}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){if(hasClass(a,b)){var c=new RegExp('(\\s|^)'+b+'(\\s|$)');a.className=a.className.replace(c,' ')}}function goToPreviousStep(){const a="step-active",c=document.getElementById('pasText'),e=document.getElementById('pasTextAlt'),j=document.getElementById('step1'),k=document.getElementById('step2'),f=document.getElementById('step3'),g=document.getElementById('step1alt'),h=document.getElementById('step2alt'),i=document.getElementById('step3alt'),d=document.getElementById('nextBtnWrapperRov'),b=document.getElementById('prevBtnWrapperRov');let l=c.getAttribute('step');switch(l){case"1":break;case"2":document.getElementById('nextButton').innerHTML="Continuă la selectarea rovinietei",addClass(j,a),removeClass(k,a),removeClass(f,a),addClass(g,a),removeClass(h,a),removeClass(i,a),c.innerHTML="Pasul 1",e.innerHTML="Pasul 1",c.setAttribute('step','1'),e.setAttribute('step','1'),removeClass(d,'slider2'),addClass(d,'slider1'),removeClass(b,'slider2'),addClass(b,'slider1'),$(window).scrollTop(0);break;case"3":document.getElementById('nextButton').innerHTML="Continuă la detalii proprietar",removeClass(j,a),addClass(k,a),removeClass(f,a),removeClass(g,a),addClass(h,a),removeClass(i,a),c.innerHTML="Pasul 2",e.innerHTML="Pasul 2",c.setAttribute('step','2'),e.setAttribute('step','2'),hasClass(d,'slider2')||(addClass(d,'slider2'),removeClass(d,'slider1')),hasClass(b,'slider2')||(addClass(b,'slider2'),removeClass(b,'slider1')),removeClass(b,'slider3'),$(window).scrollTop(0);break}}function goToNextStep(l){const a="step-active",b=document.getElementById('pasText'),d=document.getElementById('pasTextAlt'),e=document.getElementById('step1'),f=document.getElementById('step2'),g=document.getElementById('step3'),h=document.getElementById('step1alt'),i=document.getElementById('step2alt'),j=document.getElementById('step3alt'),k=document.getElementById('nextBtnWrapperRov'),c=document.getElementById('prevBtnWrapperRov');let m=b.getAttribute('step');switch(m){case"1":getVignetteCategoryPrices(localStorage.getItem('selectedCategory')),document.getElementById('nextButton').innerHTML="Continuă la detalii proprietar",removeClass(e,a),addClass(f,a),removeClass(g,a),removeClass(h,a),addClass(i,a),removeClass(j,a),b.innerHTML="Pasul 2",d.innerHTML="Pasul 2",b.setAttribute('step','2'),d.setAttribute('step','2'),removeClass(k,'slider1'),addClass(k,'slider2'),removeClass(c,'slider1'),addClass(c,'slider2'),$(window).scrollTop(0);break;case"2":const m=document.querySelector('input[name="availability"]:checked').value;if(m=='1'||m=='2'?document.getElementById('vin').removeAttribute('required'):document.getElementById('vin').setAttribute('required','required'),document.getElementById('vin').value?.trim()===""&&m!=1&&m!=2)return l.preventDefault(),generateToast({message:"Toate campurile trebuie completate",background:"hsl(350 100% 66.5%)",color:"hsl(350 100% 13.5%)"}),document.getElementById('pasText').innerHTML="Pasul 3",b.setAttribute('step','3'),d.setAttribute('step','3'),document.getElementById('prevButton').click(),!1;document.getElementById('phone').removeAttribute('required'),removeClass(e,a),removeClass(f,a),addClass(g,a),removeClass(h,a),removeClass(i,a),addClass(j,a),b.innerHTML="Pasul 3",d.innerHTML="Pasul 3",b.setAttribute('step','3'),d.setAttribute('step','3'),$(window).scrollTop(0),removeClass(c,'slider1'),removeClass(c,'slider2'),addClass(c,'slider3');break;case"3":break}}function postVignetteAllData(b,c){var a=new XMLHttpRequest;a.open('POST',`${base_url}/vignette-policies/all-data?${c}`,!0),a.setRequestHeader('Authorization',`Bearer ${token}`),a.setRequestHeader('Content-Type','application/json'),a.onload=function(){var c=JSON.parse(this.response);a.status>=200&&a.status<400?(b==="card"&&postMobilpay(c.data.order_id),b==="rate"&&postTbi(c.data.order_id)):(generateToast({message:c.error.pretty_message,background:errorBg,color:errorColor}),console.log('Error fetching offer data: '+c.error.pretty_message))},a.send()}function postMobilpay(b){var a=new XMLHttpRequest;a.open('POST',`${base_url}/payu/create?order_id=${b}`,!0),a.setRequestHeader('Authorization',`Bearer ${token}`),a.setRequestHeader('Content-Type','application/json'),a.onload=function(){var b=JSON.parse(this.response);a.status>=200&&a.status<400?getMobilpay(b.data.token):(generateToast({message:b.error.pretty_message,background:errorBg,color:errorColor}),console.log('Error fetching offer data: '+b.error.pretty_message))},a.send()}function postTbi(b,c=4){var a=new XMLHttpRequest;a.open('POST',`${base_url}/tbi/create?order_id=${b}&instalments=${c}`,!0),a.setRequestHeader('Authorization',`Bearer ${token}`),a.setRequestHeader('Content-Type','application/json'),a.onload=function(){var b=JSON.parse(this.response);a.status>=200&&a.status<400?getTbi(b.data.token):(generateToast({message:b.error.pretty_message,background:errorBg,color:errorColor}),console.log('Error fetching offer data: '+b.error.pretty_message))},a.send()}function getMobilpay(a){window.location.href=`${base_url_mobilpay}/payu?token=${a}`}function getTbi(a){window.location.href=`${base_url_mobilpay}/tbi?token=${a}`}function addCategoryToLocalStorage(a){localStorage.setItem('selectedCategory',a.target.value)}window.onload=function(){initToast(),addClass(document.getElementById('nextBtnWrapperRov'),'slider1'),addClass(document.getElementById('prevBtnWrapperRov'),'slider1'),document.getElementById('nextButton').innerHTML="Continuă la selectarea rovinietei";const a=document.getElementById('wf-form-rovinieta-detalii');a.addEventListener('submit',handleSubmit);const b=document.getElementById('1');b.addEventListener('click',addCategoryToLocalStorage);const c=document.getElementById('2');c.addEventListener('click',addCategoryToLocalStorage);const d=document.getElementById('auto3');d.addEventListener('click',addCategoryToLocalStorage);const e=document.getElementById('auto4');e.addEventListener('click',addCategoryToLocalStorage);const f=document.getElementById('auto5');f.addEventListener('click',addCategoryToLocalStorage);const g=document.getElementById('auto6');g.addEventListener('click',addCategoryToLocalStorage);const h=document.getElementById('auto7');h.addEventListener('click',addCategoryToLocalStorage);const i=document.getElementById('auto8');i.addEventListener('click',addCategoryToLocalStorage),document.getElementById('1').click();const j=document.getElementById('start_date');j.flatpickr({altInput:!0,defaultDate:new Date,minDate:new Date,allowInput:!0,maxDate:(new Date).setMonth((new Date).getMonth()+1),altFormat:"d.m.Y",dateFormat:"d.m.Y"});const k=document.getElementById('nextButton');k.addEventListener('click',goToNextStep);const l=document.getElementById('prevButton');l.addEventListener('click',goToPreviousStep);const m=document.getElementById('pasText'),n=document.getElementById('pasTextAlt');m.setAttribute('step','1'),n.setAttribute('step','1'),$(document).on('keyup','#vin',function(){let b=$(this).val(),a=b.replace(/[^a-zA-Z0-9\/]/g,'');a=a.toUpperCase(),$(this).val(a)})},console.log("V1")