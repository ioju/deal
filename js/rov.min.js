var slide1Height=$("#step-slide1 .collaborate-form-step").height();var slide2Height=$("#step-slide2 .collaborate-form-step").height();console.log(slide1Height);console.log(slide2Height);const base_url="https://app-dev.autodeal.ro/api/v1";const base_url_mobilpay="https://app-dev.autodeal.ro";const token="100644|9ZcG86c7wzuhPBrnIJ9D1DwsrZOSsgvL7DJbdp9l";const errorColor="hsl(350 100% 13.5%)";const errorBg="hsl(350 100% 66.5%)";async function getVignetteCategoryPrices(categoryId){await fetch(`${base_url}/vignette-categories/${categoryId}/prices`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`,"Permissions-Policy":"ch-ua-form-factor"}}).then(response=>response.json()).then(data=>addPrices(data.data))}function removeSuccess(seconds=0){setTimeout(function(){container=document.getElementById("successMessageSubmit");if(container==null)return;container.style.display="none";form=document.getElementById("wf-form-rovinieta-detalii");form.style.display="block"},seconds*1e3)}function addPrices(availabilities){const parent=document.getElementById("rovList");parent.innerHTML="";var row=document.createElement("div");addClass(row,"w-clearfix");for(let i=0;i<availabilities.length;i++){var availability=availabilities[i];var categoryDivInput=document.createElement("div");addClass(categoryDivInput,"input-group input-fullwidth rovinieta-input");var categoryDivWrap=document.createElement("div");addClass(categoryDivWrap,"extra-option-wrap");var label=document.createElement("label");addClass(label,"radio-button-field-2 fullwidth w-clearfix w-radio");var categoryDivRadioInput=document.createElement("div");addClass(categoryDivRadioInput,"w-form-formradioinput w-form-formradioinput--inputType-custom radio-button-2 w-radio-input");if(i==0){addClass(categoryDivRadioInput,"w--redirected-checked");localStorage.setItem("selectedAvailability",availability.availability_code)}var input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("name","availability");input.setAttribute("data-name","availability");input.setAttribute("style","opacity:0;position:absolute;z-index:-1");input.setAttribute("value",availability.availability_code);input.setAttribute("id","availability"+i);var span=document.createElement("span");addClass(span,"radio-button-label-2 radio-button-label-3 w-form-label");span.setAttribute("for","availability"+i);var strong=document.createElement("strong");addClass(strong,"bold-text-3");strong.innerHTML=availability.availability_name;span.appendChild(strong);var div13=document.createElement("div");addClass(div13,"div-block-13");var text13=document.createElement("div");addClass(text13,"text-block-13");text13.innerHTML=availability.value+" "+availability.currency_code;var eur=document.createElement("div");addClass(eur,"eur");eur.innerHTML=availability.authority_value+" "+availability.authority_currency_code;div13.appendChild(text13);div13.appendChild(eur);label.appendChild(categoryDivRadioInput);label.appendChild(input);label.appendChild(span);label.appendChild(div13);label.addEventListener("click",function(event){if(event.target.type=="radio"){localStorage.setItem("selectedAvailability",event.target.value)}});categoryDivWrap.appendChild(label);categoryDivInput.appendChild(categoryDivWrap);row.appendChild(categoryDivInput)}parent.appendChild(row)}let toastContainer;function generateToast({message,background="#00214d",color="#fffffe",length="3000ms"}){toastContainer.insertAdjacentHTML("beforeend",`<p class="toast" 
    style="background-color: ${background};
    color: ${color};
    animation-duration: ${length}">
    ${message}
  </p>`);const toast=toastContainer.lastElementChild;toast.addEventListener("animationend",()=>toast.remove())}function initToast(){document.body.insertAdjacentHTML("afterbegin",`<div class="toast-container"></div>
  <style>
  .toast-container{position:fixed;z-index:10000;top:8rem;right:1.5rem;display:grid;justify-items:end;gap:.5rem}.toast{line-height:1;padding:.5em 1em;animation:toastIt 7000ms cubic-bezier(.785,.135,.15,.86) forwards;border-radius:4px;font-size:12px;font-weight:400;background:hsl(0,0%,91.8%)!important}@keyframes toastIt{0%,100%{transform:translateY(-150%);opacity:0}10%,90%{transform:translateY(0);opacity:1}}@media screen and (max-width:991px){.toast-container{justify-items:center;background:#fff;width:100%}.toast-container .toast{margin-top:1em}}
  </style>
  `);toastContainer=document.querySelector(".toast-container")}function handleSubmit(event){event.preventDefault();const license=localStorage.getItem("license-number");const availability=localStorage.getItem("selectedAvailability");const data=new FormData(event.target);data.append("availability",availability);data.append("registration_number",license);const queryString=new URLSearchParams(data);queryString.delete("_redirect");localStorage.setItem("querystring2",queryString.toString());const qs=localStorage.getItem("querystring2");postVignetteAllData("card",qs);removeSuccess(5)}function hasClass(ele,cls){return new RegExp("(\\s|^)"+cls+"(\\s|$)").exec(ele.className)}function addClass(ele,cls){if(!hasClass(ele,cls))ele.className+=" "+cls}function removeClass(ele,cls){if(hasClass(ele,cls)){var reg=new RegExp("(\\s|^)"+cls+"(\\s|$)");ele.className=ele.className.replace(reg," ")}}function goToPreviousStep(){const classToChange="step-active";const pas=document.getElementById("pasText");const pasAlt=document.getElementById("pasTextAlt");const step1=document.getElementById("step1");const step2=document.getElementById("step2");const step3=document.getElementById("step3");const step1alt=document.getElementById("step1alt");const step2alt=document.getElementById("step2alt");const step3alt=document.getElementById("step3alt");const nextWrapper=document.getElementById("nextBtnWrapperRov");const prevWrapper=document.getElementById("prevBtnWrapperRov");let step=pas.getAttribute("step");console.log("Pasul inapoi "+step);switch(step){case"1":break;case"2":document.getElementById("nextButton").innerHTML="Continuă la selectarea rovinietei";addClass(step1,classToChange);removeClass(step2,classToChange);removeClass(step3,classToChange);addClass(step1alt,classToChange);removeClass(step2alt,classToChange);removeClass(step3alt,classToChange);pas.innerHTML="Pasul 1";pasAlt.innerHTML="Pasul 1";pas.setAttribute("step","1");pasAlt.setAttribute("step","1");removeClass(nextWrapper,"slider2");addClass(nextWrapper,"slider1");removeClass(prevWrapper,"slider2");addClass(prevWrapper,"slider1");$(window).scrollTop(0);break;case"3":document.getElementById("nextButton").innerHTML="Continuă la detalii proprietar";removeClass(step1,classToChange);addClass(step2,classToChange);removeClass(step3,classToChange);removeClass(step1alt,classToChange);addClass(step2alt,classToChange);removeClass(step3alt,classToChange);pas.innerHTML="Pasul 2";pasAlt.innerHTML="Pasul 2";pas.setAttribute("step","2");pasAlt.setAttribute("step","2");if(!hasClass(nextWrapper,"slider2")){addClass(nextWrapper,"slider2");removeClass(nextWrapper,"slider1")}if(!hasClass(prevWrapper,"slider2")){addClass(prevWrapper,"slider2");removeClass(prevWrapper,"slider1")}removeClass(prevWrapper,"slider3");$(window).scrollTop(0);break}}function goToNextStep(event){const classToChange="step-active";const pas=document.getElementById("pasText");const pasAlt=document.getElementById("pasTextAlt");const step1=document.getElementById("step1");const step2=document.getElementById("step2");const step3=document.getElementById("step3");const step1alt=document.getElementById("step1alt");const step2alt=document.getElementById("step2alt");const step3alt=document.getElementById("step3alt");const nextWrapper=document.getElementById("nextBtnWrapperRov");const prevWrapper=document.getElementById("prevBtnWrapperRov");let step=pas.getAttribute("step");console.log("Pasul inainte "+step);switch(step){case"1":getVignetteCategoryPrices(localStorage.getItem("selectedCategory"));document.getElementById("nextButton").innerHTML="Continuă la detalii proprietar";removeClass(step1,classToChange);addClass(step2,classToChange);removeClass(step3,classToChange);removeClass(step1alt,classToChange);addClass(step2alt,classToChange);removeClass(step3alt,classToChange);pas.innerHTML="Pasul 2";pasAlt.innerHTML="Pasul 2";pas.setAttribute("step","2");pasAlt.setAttribute("step","2");removeClass(nextWrapper,"slider1");addClass(nextWrapper,"slider2");removeClass(prevWrapper,"slider1");addClass(prevWrapper,"slider2");$(window).scrollTop(0);break;case"2":console.log(document.querySelector('input[name="availability"]').value);const availability=document.querySelector('input[name="availability"]:checked').value;if(availability=="1"||availability=="2"){console.log("1 sau 2");document.getElementById("vin").removeAttribute("required")}else{console.log("nu 1 nu 2");document.getElementById("vin").setAttribute("required","required")}if(document.getElementById("vin").value?.trim()===""&&availability!=1&&availability!=2){event.preventDefault();generateToast({message:"Toate campurile trebuie completate",background:"hsl(350 100% 66.5%)",color:"hsl(350 100% 13.5%)"});document.getElementById("pasText").innerHTML="Pasul 3";pas.setAttribute("step","3");pasAlt.setAttribute("step","3");document.getElementById("prevButton").click();return false}document.getElementById("phone").removeAttribute("required");removeClass(step1,classToChange);removeClass(step2,classToChange);addClass(step3,classToChange);removeClass(step1alt,classToChange);removeClass(step2alt,classToChange);addClass(step3alt,classToChange);pas.innerHTML="Pasul 3";pasAlt.innerHTML="Pasul 3";pas.setAttribute("step","3");pasAlt.setAttribute("step","3");$(window).scrollTop(0);removeClass(prevWrapper,"slider1");removeClass(prevWrapper,"slider2");addClass(prevWrapper,"slider3");break;case"3":break}}function postVignetteAllData(type,qs){var request=new XMLHttpRequest;request.open("POST",`${base_url}/vignette-policies/all-data?${qs}`,true);request.setRequestHeader("Authorization",`Bearer ${token}`);request.setRequestHeader("Content-Type","application/json");request.onload=function(){var data=JSON.parse(this.response);if(request.status>=200&&request.status<400){if(type==="card"){postMobilpay(data.data.order_id)}if(type==="rate"){postTbi(data.data.order_id)}}else{generateToast({message:data.error.pretty_message,background:errorBg,color:errorColor});console.log("Error fetching offer data: "+data.error.pretty_message)}};request.send()}function postMobilpay(orderId){var request=new XMLHttpRequest;request.open("POST",`${base_url}/payu/create?order_id=${orderId}`,true);request.setRequestHeader("Authorization",`Bearer ${token}`);request.setRequestHeader("Content-Type","application/json");request.onload=function(){var data=JSON.parse(this.response);console.log("postMobilpay");console.log(data);if(request.status>=200&&request.status<400){getMobilpay(data.data.token)}else{generateToast({message:data.error.pretty_message,background:errorBg,color:errorColor});console.log("Error fetching offer data: "+data.error.pretty_message)}};request.send()}function postTbi(orderId,instalments=4){var request=new XMLHttpRequest;request.open("POST",`${base_url}/tbi/create?order_id=${orderId}&instalments=${instalments}`,true);request.setRequestHeader("Authorization",`Bearer ${token}`);request.setRequestHeader("Content-Type","application/json");request.onload=function(){var data=JSON.parse(this.response);if(request.status>=200&&request.status<400){getTbi(data.data.token)}else{generateToast({message:data.error.pretty_message,background:errorBg,color:errorColor});console.log("Error fetching offer data: "+data.error.pretty_message)}};request.send()}function getMobilpay(tokn){window.location.href=`${base_url_mobilpay}/payu?token=${tokn}`}function getTbi(tokn){window.location.href=`${base_url_mobilpay}/tbi?token=${tokn}`}function addCategoryToLocalStorage(event){localStorage.setItem("selectedCategory",event.target.value)}window.onload=function(){initToast();addClass(document.getElementById("nextBtnWrapperRov"),"slider1");addClass(document.getElementById("prevBtnWrapperRov"),"slider1");document.getElementById("nextButton").innerHTML="Continuă la selectarea rovinietei";const form=document.getElementById("wf-form-rovinieta-detalii");form.addEventListener("submit",handleSubmit);const radio1=document.getElementById("1");radio1.addEventListener("click",addCategoryToLocalStorage);const radio2=document.getElementById("2");radio2.addEventListener("click",addCategoryToLocalStorage);const radio3=document.getElementById("auto3");radio3.addEventListener("click",addCategoryToLocalStorage);const radio4=document.getElementById("auto4");radio4.addEventListener("click",addCategoryToLocalStorage);const radio5=document.getElementById("auto5");radio5.addEventListener("click",addCategoryToLocalStorage);const radio6=document.getElementById("auto6");radio6.addEventListener("click",addCategoryToLocalStorage);const radio7=document.getElementById("auto7");radio7.addEventListener("click",addCategoryToLocalStorage);const radio8=document.getElementById("auto8");radio8.addEventListener("click",addCategoryToLocalStorage);document.getElementById("1").click();const start_date=document.getElementById("start_date");start_date.flatpickr({altInput:true,defaultDate:new Date,minDate:new Date,allowInput:true,maxDate:(new Date).setMonth((new Date).getMonth()+1),altFormat:"d.m.Y",dateFormat:"d.m.Y"});const next=document.getElementById("nextButton");next.addEventListener("click",goToNextStep);const prev=document.getElementById("prevButton");prev.addEventListener("click",goToPreviousStep);const pas=document.getElementById("pasText");const pasAlt=document.getElementById("pasTextAlt");pas.setAttribute("step","1");pasAlt.setAttribute("step","1")};console.log("V1");
